{"remainingRequest":"C:\\Users\\Monya\\Desktop\\my-project\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Monya\\Desktop\\my-project\\src\\views\\book\\BookModifyPage.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Monya\\Desktop\\my-project\\src\\views\\book\\BookModifyPage.vue","mtime":1556525649259},{"path":"C:\\Users\\Monya\\Desktop\\my-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1555329071562},{"path":"C:\\Users\\Monya\\Desktop\\my-project\\node_modules\\babel-loader\\lib\\index.js","mtime":1555329027271},{"path":"C:\\Users\\Monya\\Desktop\\my-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1555329071562},{"path":"C:\\Users\\Monya\\Desktop\\my-project\\node_modules\\vue-loader\\lib\\index.js","mtime":1555329073101}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { updateBookById } from '../../api/book'\r\nimport { getBookById } from '../../api/book'\r\nimport reqwest from 'reqwest'\r\n\r\nfunction getBase64(img, callback) {\r\n  const reader = new FileReader()\r\n  reader.addEventListener('load', () => callback(reader.result))\r\n  reader.readAsDataURL(img)\r\n}\r\n\r\nexport default {\r\n  name: 'BookModifyPage',\r\n  data() {\r\n    return {\r\n      description: '图书修改页',\r\n      value: 1,\r\n      // form\r\n      form: this.$form.createForm(this),\r\n      book: { bookid: 1 },\r\n      fileList: [],\r\n      uploading: false,\r\n    }\r\n  },\r\n  mounted() {\r\n    this.fetchData()\r\n  },\r\n  methods: {\r\n    fetchData() {\r\n      getBookById(this.$route.params.id).then(res => {\r\n        var data = res.result.data\r\n        this.book = data\r\n      })\r\n    },\r\n    confirm(e) {\r\n      // console.log(e)\r\n      this.handleSubmit(e)\r\n    },\r\n    cancel(e) {\r\n      // console.log(e)\r\n      this.$message.warning('请重新输入')\r\n    },\r\n    // handler\r\n    handleSubmit(e) {\r\n      e.preventDefault()\r\n      var bookid = this.$route.params.id\r\n      this.form.validateFields((err, values) => {\r\n        if (!err) {\r\n          // eslint-disable-next-line no-console\r\n          console.log('Received values of form: ', values)\r\n          updateBookById(bookid, values).then(res => {\r\n            console.log('res::', res)\r\n            console.log(Number(res.result.bookid) == bookid)\r\n            if (Number(res.result.bookid) == bookid) {\r\n              this.$message.success('修改成功')\r\n              this.$router.push({ name: 'BookDetailPage', params: { id: bookid } }) // 修改成功后跳转到详情页\r\n            } else {\r\n              this.$message.error('修改失败')\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n    handleRemove(file) {\r\n      const index = this.fileList.indexOf(file);\r\n      const newFileList = this.fileList.slice();\r\n      newFileList.splice(index, 1);\r\n      this.fileList = newFileList\r\n    },\r\n    beforeUpload(file) {\r\n      this.fileList = [...this.fileList, file]\r\n      return false;\r\n    },\r\n    handleUpload() {\r\n      const { fileList } = this;\r\n      const formData = new FormData();\r\n      fileList.forEach((file) => {\r\n        formData.append('files[]', file);\r\n      });\r\n      this.uploading = true\r\n\r\n      // You can use any AJAX library you like\r\n      reqwest({\r\n        url: '//jsonplaceholder.typicode.com/posts/',\r\n        method: 'post',\r\n        processData: false,\r\n        data: formData,\r\n        success: () => {\r\n          this.fileList = []\r\n          this.uploading = false\r\n          this.$message.success('upload successfully.');\r\n        },\r\n        error: () => {\r\n          this.uploading = false\r\n          this.$message.error('upload failed.');\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["BookModifyPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BookModifyPage.vue","sourceRoot":"src/views/book","sourcesContent":["<template>\r\n  <a-card :body-style=\"{padding: '24px 32px'}\" :bordered=\"false\">\r\n    <a-form @submit=\"handleSubmit\" :form=\"form\">\r\n      <a-form-item\r\n        label=\"图书名称\"\r\n        :labelCol=\"{lg: {span: 7}, sm: {span: 7}}\"\r\n        :wrapperCol=\"{lg: {span: 10}, sm: {span: 17} }\"\r\n      >\r\n        <a-input\r\n          v-decorator=\"[\r\n            'bookname',\r\n            {rules: [{ required: true, message: '请输入标题' }]}\r\n          ]\"\r\n          name=\"name\"\r\n          :placeholder=\"book.bookname\"\r\n        />\r\n      </a-form-item>\r\n      <a-form-item\r\n        label=\"图书风格/分类\"\r\n        :labelCol=\"{lg: {span: 7}, sm: {span: 7}}\"\r\n        :wrapperCol=\"{lg: {span: 10}, sm: {span: 17} }\"\r\n      >\r\n        <a-textarea\r\n          rows=\"4\"\r\n          :placeholder=\"book.bookstyle\"\r\n          v-decorator=\"[\r\n            'bookstyle',\r\n            {rules: [{ required: true,message:'请输入风格/分类'}]}\r\n          ]\"\r\n        />\r\n      </a-form-item>\r\n      <a-form-item\r\n        label=\"图书avatar\"\r\n        :labelCol=\"{lg: {span: 7}, sm: {span: 7}}\"\r\n        :wrapperCol=\"{lg: {span: 10}, sm: {span: 17} }\"\r\n      >\r\n        <a-input\r\n          :placeholder=\"book.avatar\"\r\n          v-decorator=\"[\r\n        'avatar',\r\n        {rules: [{ required: true, message: '请输入图书的avatar' }]}\r\n        ]\"\r\n        />\r\n      </a-form-item>\r\n\r\n      <a-form-item>\r\n        <div class=\"clearfix\">\r\n          <a-upload :fileList=\"fileList\" :remove=\"handleRemove\" :beforeUpload=\"beforeUpload\">\r\n            <a-button>\r\n              <a-icon type=\"upload\"/>Select File\r\n            </a-button>\r\n          </a-upload>\r\n          <a-button\r\n            type=\"primary\"\r\n            @click=\"handleUpload\"\r\n            :disabled=\"fileList.length === 0\"\r\n            :loading=\"uploading\"\r\n            style=\"margin-top: 16px\"\r\n          >{{uploading ? 'Uploading' : 'Start Upload' }}</a-button>\r\n        </div>\r\n      </a-form-item>\r\n\r\n      <a-form-item :wrapperCol=\"{ span: 24 }\" style=\"text-align: center\">\r\n        <a-popconfirm title=\"确定提交\" @confirm=\"confirm\" @cancel=\"cancel\" okText=\"Yes\" cancelText=\"No\">\r\n          <a-button htmlType=\"submit\" type=\"primary\">提交</a-button>\r\n        </a-popconfirm>\r\n        <!-- <a-button style=\"margin-left: 8px\">保存</a-button> -->\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-card>\r\n</template>\r\n\r\n<script>\r\nimport { updateBookById } from '../../api/book'\r\nimport { getBookById } from '../../api/book'\r\nimport reqwest from 'reqwest'\r\n\r\nfunction getBase64(img, callback) {\r\n  const reader = new FileReader()\r\n  reader.addEventListener('load', () => callback(reader.result))\r\n  reader.readAsDataURL(img)\r\n}\r\n\r\nexport default {\r\n  name: 'BookModifyPage',\r\n  data() {\r\n    return {\r\n      description: '图书修改页',\r\n      value: 1,\r\n      // form\r\n      form: this.$form.createForm(this),\r\n      book: { bookid: 1 },\r\n      fileList: [],\r\n      uploading: false,\r\n    }\r\n  },\r\n  mounted() {\r\n    this.fetchData()\r\n  },\r\n  methods: {\r\n    fetchData() {\r\n      getBookById(this.$route.params.id).then(res => {\r\n        var data = res.result.data\r\n        this.book = data\r\n      })\r\n    },\r\n    confirm(e) {\r\n      // console.log(e)\r\n      this.handleSubmit(e)\r\n    },\r\n    cancel(e) {\r\n      // console.log(e)\r\n      this.$message.warning('请重新输入')\r\n    },\r\n    // handler\r\n    handleSubmit(e) {\r\n      e.preventDefault()\r\n      var bookid = this.$route.params.id\r\n      this.form.validateFields((err, values) => {\r\n        if (!err) {\r\n          // eslint-disable-next-line no-console\r\n          console.log('Received values of form: ', values)\r\n          updateBookById(bookid, values).then(res => {\r\n            console.log('res::', res)\r\n            console.log(Number(res.result.bookid) == bookid)\r\n            if (Number(res.result.bookid) == bookid) {\r\n              this.$message.success('修改成功')\r\n              this.$router.push({ name: 'BookDetailPage', params: { id: bookid } }) // 修改成功后跳转到详情页\r\n            } else {\r\n              this.$message.error('修改失败')\r\n            }\r\n          })\r\n        }\r\n      })\r\n    },\r\n    handleRemove(file) {\r\n      const index = this.fileList.indexOf(file);\r\n      const newFileList = this.fileList.slice();\r\n      newFileList.splice(index, 1);\r\n      this.fileList = newFileList\r\n    },\r\n    beforeUpload(file) {\r\n      this.fileList = [...this.fileList, file]\r\n      return false;\r\n    },\r\n    handleUpload() {\r\n      const { fileList } = this;\r\n      const formData = new FormData();\r\n      fileList.forEach((file) => {\r\n        formData.append('files[]', file);\r\n      });\r\n      this.uploading = true\r\n\r\n      // You can use any AJAX library you like\r\n      reqwest({\r\n        url: '//jsonplaceholder.typicode.com/posts/',\r\n        method: 'post',\r\n        processData: false,\r\n        data: formData,\r\n        success: () => {\r\n          this.fileList = []\r\n          this.uploading = false\r\n          this.$message.success('upload successfully.');\r\n        },\r\n        error: () => {\r\n          this.uploading = false\r\n          this.$message.error('upload failed.');\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}